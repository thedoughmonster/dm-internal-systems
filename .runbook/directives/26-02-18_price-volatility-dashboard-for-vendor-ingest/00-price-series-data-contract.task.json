{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "title": "Price series data contract and backend plumbing",
    "summary": "Define backend/API contract for per-vendor item price-over-time data with 90-day default window and granularity controls.",
    "status": "done",
    "created": "2026-02-18T13:36:36.534Z",
    "updated": "2026-02-18T14:57:09.461Z",
    "id": "fd14946d-fe3a-4072-bbad-7758478d34fe",
    "priority": "high",
    "session_priority": "medium",
    "owner": "operator",
    "assignee": "executor",
    "bucket": "todo",
    "tags": [],
    "effort": "medium",
    "depends_on": [],
    "blocked_by": [],
    "related": [],
    "execution_model": "gpt-5.3-codex",
    "thinking_level": "medium",
    "result": {
      "summary": "Implemented_90-day_default_vendor_price-series_contract_with_granularity-range_support_and_metadata-rich_response.",
      "validation": "PASS_rg_and_typecheck_for_task_00_contract_changes.",
      "updated": "2026-02-18T14:57:09Z"
    }
  },
  "task": {
    "objective": "Implement and document a backend contract that returns per-vendor item price time-series data with a 90-day default window, selectable date range, and granularity options required by dashboard consumers.",
    "constraints": [
      "Preserve existing vendor ingest behavior and avoid regressions in current price changes surfaces.",
      "Default query window is 90 days when no explicit range is provided.",
      "UI-facing access must go through approved server/function boundaries; no direct client-side DB access patterns.",
      "Data contract must include observation count and timestamps needed for downstream volatility calculations."
    ],
    "allowed_files": [
      {
        "path": "supabase/functions/vendor_price_change_series_read_v1/index.ts",
        "access": "edit",
        "note": "Primary backend function for price-series retrieval."
      },
      {
        "path": "apps/web/app/vendors/ingest/price-changes/lib/api.ts",
        "access": "edit",
        "note": "Typed client API adapter for dashboard queries."
      },
      {
        "path": "apps/web/app/vendors/ingest/price-changes/lib/types.ts",
        "access": "edit",
        "note": "Shared request/response contracts for overview and drill-down consumers."
      },
      {
        "path": "supabase/migrations/...",
        "access": "edit",
        "note": "Schema/index updates only if required for range/granularity or performance."
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Define request/response schema for vendor, item, date range, and granularity with explicit defaults.",
        "files": [
          "supabase/functions/vendor_price_change_series_read_v1/index.ts",
          "apps/web/app/vendors/ingest/price-changes/lib/types.ts"
        ],
        "artifact": "Typed contract covering success and error states used by UI."
      },
      {
        "id": "step_2",
        "instruction": "Implement backend query path to return ordered price points and metadata used by volatility calculations.",
        "files": [
          "supabase/functions/vendor_price_change_series_read_v1/index.ts"
        ],
        "artifact": "Function output includes stable time-series plus observation metadata."
      },
      {
        "id": "step_3",
        "instruction": "Update API adapter to consume the backend contract with safe defaults and error normalization.",
        "files": [
          "apps/web/app/vendors/ingest/price-changes/lib/api.ts"
        ],
        "artifact": "UI layer can request 90-day series without caller-side fallback logic."
      }
    ],
    "validation": {
      "commands": [
        "rg -n \"90|days|granularity|observation\" supabase/functions/vendor_price_change_series_read_v1/index.ts apps/web/app/vendors/ingest/price-changes/lib/types.ts",
        "npm --prefix apps/web run typecheck"
      ]
    },
    "expected_output": [
      "Backend/API contract exposes a 90-day default series with range/granularity controls.",
      "Response payload includes fields needed by ranking and drill-down tasks.",
      "Typecheck passes for updated API/types usage."
    ],
    "stop_conditions": [
      "Stop and ask operator if schema changes are required beyond vendor price-series scope or if migration risk exceeds directive intent."
    ],
    "notes": [
      "Keep contract additive where possible to reduce integration risk for existing screens."
    ]
  }
}
