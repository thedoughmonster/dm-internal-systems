{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "title": "Implement global sidebar layout shell and active-route correctness",
    "summary": "Refactor apps/web shell to one layout-bound sidebar with fixed header, independent scroll regions, collapsible icon mode, fixed footer, and deterministic single active route.",
    "status": "done",
    "created": "2026-02-19T09:53:35.311Z",
    "updated": "2026-02-19T11:14:47.197Z",
    "id": "a5ba8a2b-986b-4e11-8587-971ebee57c5d",
    "priority": "high",
    "session_priority": "medium",
    "owner": "operator",
    "assignee": "executor",
    "bucket": "done",
    "tags": [
      "apps-web",
      "sidebar",
      "layout",
      "routing"
    ],
    "effort": "medium",
    "depends_on": [],
    "blocked_by": [],
    "related": [],
    "execution_model": "gpt-5.3-codex",
    "thinking_level": "medium",
    "completion_summary": "Executor-task handoff complete: global sidebar/layout unification and active-route fix delivered; validation status: runbook validate --session 26-02-19_global-sidebar-layout-unification passed (ok=true), and task-level apps/web lint/typecheck were previously completed."
  },
  "task": {
    "objective": "Implement one global layout-bound sidebar shell in apps/web with a shared fixed header, independent sidebar/content scrolling, collapsible icon-column behavior with distinct item icons, fixed sidebar footer placement, and deterministic single active-route highlighting.",
    "constraints": [
      "Do not change route paths, page ownership, or navigation registry information architecture.",
      "Keep sidebar behavior responsive: desktop persistent rail and mobile sheet/drawer.",
      "Do not add dependencies or modify package manifests.",
      "Preserve accessibility semantics for navigation, keyboard focus, and aria-current usage.",
      "Limit implementation changes to apps/web surfaces listed in allowed files."
    ],
    "allowed_files": [
      {
        "path": "`apps/web/app/layout.tsx` (edit)",
        "access": "edit"
      },
      {
        "path": "`apps/web/app/composites/global-sidebar-shell.tsx` (edit)",
        "access": "edit"
      },
      {
        "path": "`apps/web/components/ui/sidebar.tsx` (edit)",
        "access": "edit"
      },
      {
        "path": "`apps/web/lib/navigation-registry.ts` (edit only if icon mapping must be corrected)",
        "access": "edit"
      },
      {
        "path": "`apps/web/lib/global-sidebar-slot.tsx` (edit only if slot composition is required)",
        "access": "edit"
      },
      {
        "path": "`apps/web/app/styles/tokens-semantic.css` (edit only if sidebar semantic tokens require alignment)",
        "access": "edit"
      },
      {
        "path": "`apps/web/changelog/*.md` (create)",
        "access": "create"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Refactor the layout composition so all apps/web internal pages consume a single global sidebar shell located in the main app container directly adjacent to content under one fixed header.",
        "files": [
          "apps/web/app/layout.tsx",
          "apps/web/app/composites/global-sidebar-shell.tsx"
        ],
        "artifact": "A single canonical sidebar shell is rendered by layout and reused across intended routes."
      },
      {
        "id": "step_2",
        "instruction": "Apply viewport-height shell structure so sidebar and content columns each scroll independently while header remains fixed and non-scrolling.",
        "files": [
          "apps/web/app/composites/global-sidebar-shell.tsx",
          "apps/web/components/ui/sidebar.tsx"
        ],
        "artifact": "Sidebar and content regions have independent overflow behavior without full-page scroll coupling."
      },
      {
        "id": "step_3",
        "instruction": "Implement/verify collapsible sidebar icon-column behavior and ensure each primary nav item has a distinct icon in collapsed and expanded states.",
        "files": [
          "apps/web/app/composites/global-sidebar-shell.tsx",
          "apps/web/lib/navigation-registry.ts",
          "apps/web/components/ui/sidebar.tsx"
        ],
        "artifact": "Collapsed sidebar displays icon-only rail with unique per-item icons and preserved navigation affordance."
      },
      {
        "id": "step_4",
        "instruction": "Anchor sidebar footer actions/information to a fixed bottom region of the sidebar container so footer placement is stable regardless of menu scroll depth.",
        "files": [
          "apps/web/app/composites/global-sidebar-shell.tsx",
          "apps/web/components/ui/sidebar.tsx"
        ],
        "artifact": "Sidebar footer remains pinned to the bottom while sidebar menu content can scroll independently."
      },
      {
        "id": "step_5",
        "instruction": "Correct active-route computation so exactly one intended navigation item resolves as active for each route, including nested paths.",
        "files": [
          "apps/web/app/composites/global-sidebar-shell.tsx",
          "apps/web/lib/navigation-registry.ts"
        ],
        "artifact": "No duplicate active states appear in sidebar for any single route."
      },
      {
        "id": "step_6",
        "instruction": "Add an apps/web changelog entry documenting the layout/sidebar unification and active-route correctness update with validation evidence.",
        "files": [
          "apps/web/changelog/*.md"
        ],
        "artifact": "Changelog entry exists with scope and command evidence."
      }
    ],
    "validation": {
      "commands": [
        "npm --prefix apps/web run lint",
        "npm --prefix apps/web run typecheck"
      ]
    },
    "expected_output": [
      "Global layout uses one shared sidebar shell adjacent to content under a fixed header.",
      "Sidebar/content regions scroll independently within viewport-constrained shell.",
      "Collapsed icon-column mode works and uses distinct icons per navigation item.",
      "Sidebar footer remains fixed at bottom of sidebar surface.",
      "Exactly one navigation item is active for any route state.",
      "apps/web lint and typecheck pass."
    ],
    "stop_conditions": [
      "Stop and ask operator if the requested behavior requires changing route paths or IA beyond this directive.",
      "Stop and ask operator if implementation requires edits outside allowed files.",
      "Stop and report if pre-existing lint/typecheck failures unrelated to this task block validation."
    ],
    "notes": [
      "Commit policy is end_of_directive; avoid intermediate commit assumptions in execution.",
      "This task intentionally combines shell unification and active-route logic to keep sidebar behavior deterministic in one implementation pass."
    ]
  }
}
