{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "title": "Merge-safety validation for full normalization run",
    "status": "todo",
    "priority": "high",
    "session_priority": "high",
    "owner": "operator",
    "assignee": "executor",
    "bucket": "todo",
    "created": "2026-02-12T15:05:41.000Z",
    "updated": "2026-02-12T15:05:41.000Z",
    "tags": [
      "storybook",
      "ui",
      "validation",
      "merge-safety"
    ],
    "effort": "small",
    "depends_on": [
      "TASK_08-dm-module-normalization.md"
    ],
    "blocked_by": [],
    "related": [],
    "summary": "Run complete validation suite and contract checks to prove merge safety to dev.",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "high",
    "collection_id": "sb-normalization-20260212",
    "collection_title": "Storybook normalization full run",
    "collection_order": 10,
    "collection_commit_label": "storybook-normalization-full-run",
    "collection_merge_ready": false,
    "id": "e8cb632d-f26c-4193-8eb2-ca38bed9a251"
  },
  "task": {
    "objective": "Produce merge-safety evidence for the full Storybook normalization collection.",
    "constraints": [
      "No file edits expected in this task."
    ],
    "allowed_files": [
      {
        "path": "No file edits expected.",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Run global contract checks for all `apps/web/components/ui/*.stories.tsx` and `apps/web/components/ui/dm/*.stories.tsx`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "Run lint and typecheck.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "Run Storybook smoke-test and CI build.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "Record pass/fail status for each command in task result output.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "rg -n \"Auto-generated docs scaffold\" apps/web/components/ui/**/*.stories.tsx && exit 1 || true",
        "rg -n \"Auto-generated docs scaffold\" apps/web/lib/storybook/module-docs-page.tsx && exit 1 || true",
        "rg -n \"Auto-generated docs scaffold\" apps/web/lib/storybook/module-playground.tsx && exit 1 || true",
        "for f in apps/web/components/ui/*.stories.tsx apps/web/components/ui/dm/*.stories.tsx; do",
        "rg -q \"export const Overview\" \"$f\" || { echo \"missing Overview in $f\"; exit 1; }",
        "rg -q \"export const VisibleBaseline\" \"$f\" || { echo \"missing VisibleBaseline in $f\"; exit 1; }",
        "rg --pcre2 -U -q \"export const VisibleBaseline: Story = \\\\{[\\\\s\\\\S]{0,900}ModulePlayground\" \"$f\" && { echo \"VisibleBaseline uses ModulePlayground in $f\"; exit 1; } || true",
        "done",
        "npm --prefix apps/web run lint",
        "npm --prefix apps/web run typecheck",
        "npm --prefix apps/web run storybook -- --ci --smoke-test",
        "npm --prefix apps/web run storybook:build:ci"
      ]
    },
    "expected_output": [
      "Contract checks pass for all story modules.",
      "Lint, typecheck, Storybook smoke-test, and Storybook CI build all pass.",
      "Evidence is sufficient to mark collection merge-safety as ready."
    ],
    "stop_conditions": [
      "Stop and ask operator if validations fail due to unrelated pre-existing issues."
    ],
    "notes": []
  }
}
