{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "id": "7b9f8d4b-31d2-4a0f-8f87-a8f56e9b1102",
    "title": "Configure prod branch protection in GitHub",
    "status": "todo",
    "priority": "high",
    "session_priority": "medium",
    "owner": "operator",
    "assignee": "executor",
    "bucket": "todo",
    "created": "2026-02-11T08:30:31.000Z",
    "updated": "2026-02-11T08:53:05.000Z",
    "tags": [
      "github",
      "branch-protection",
      "prod"
    ],
    "effort": "small",
    "depends_on": [
      "2eb2f53f-7d8a-4b5b-b79c-c8d1f45a1101"
    ],
    "blocked_by": [],
    "related": [],
    "summary": "Apply strict protection to prod so local direct pushes are blocked and merges are PR-gated.",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "medium"
  },
  "task": {
    "objective": "Configure GitHub branch protection for `prod` so it cannot be directly pushed and can only be updated by PR merge.",
    "constraints": [
      "Apply settings in GitHub repository settings.",
      "Do not expose tokens or secrets.",
      "Record exact settings applied."
    ],
    "allowed_files": [
      {
        "path": "`docs/DEPLOYMENT_INFRA_STATUS.md` (edit)",
        "access": "edit"
      },
      {
        "path": "`docs/DEPLOYMENT_INFRA_EVIDENCE.md` (edit)",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Open GitHub repository settings and navigate to branch protection for `prod`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "Enable \"require a pull request before merging\" for `prod`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "Enable required approval count and enable conversation resolution requirement.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "Enable blocks for force pushes and branch deletion on `prod`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_5",
        "instruction": "Restrict who can push directly to `prod` to operator or admin only.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_6",
        "instruction": "Capture non-secret verification output for `prod` branch protection (for example `gh api` branch protection response) and record key fields in `docs/DEPLOYMENT_INFRA_EVIDENCE.md`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_7",
        "instruction": "In `docs/DEPLOYMENT_INFRA_STATUS.md`, mark `TASK_02` as completed and record exact protection settings and UTC timestamp.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "rg -n \"TASK_02|prod|branch protection|completed\" docs/DEPLOYMENT_INFRA_STATUS.md",
        "rg -n \"TASK_02|prod|pull request|force push|deletion\" docs/DEPLOYMENT_INFRA_EVIDENCE.md"
      ]
    },
    "expected_output": [
      "`prod` is protected and direct push path is blocked.",
      "Status tracker records completion details."
    ],
    "stop_conditions": [
      "Stop and ask operator if repo admin access is unavailable."
    ],
    "notes": []
  }
}
