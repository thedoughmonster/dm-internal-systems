{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "id": "b85c19b7-328c-45c0-ab70-24201ff196c2",
    "title": "07-3-local-secret-population-gate",
    "status": "todo",
    "priority": "medium",
    "session_priority": "medium",
    "summary": "",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "high"
  },
  "task": {
    "objective": "Prevent downstream env sync tasks from running before required local secret source files exist and are populated.",
    "constraints": [
      "Never print secret values.",
      "Verify presence and key completeness only."
    ],
    "allowed_files": [
      {
        "path": "`scripts/env/check-local-secret-files.sh` (create)",
        "access": "edit"
      },
      {
        "path": "`docs/ENVIRONMENT_SETUP.md` (edit)",
        "access": "edit"
      },
      {
        "path": "`docs/DEPLOYMENT_INFRA_STATUS.md` (edit)",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Create `scripts/env/check-local-secret-files.sh` to verify `.env.test.local` and `.env.prod.local` exist.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "In that script, validate required key names are present in both files without printing values.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "In that script, fail if placeholder values are still present.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "Edit `docs/ENVIRONMENT_SETUP.md` and add this gate script as a prerequisite for Vercel sync commands.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_5",
        "instruction": "Edit `docs/DEPLOYMENT_INFRA_STATUS.md` and mark `TASK_07.3` complete with UTC timestamp.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "test -s scripts/env/check-local-secret-files.sh",
        "rg -n \"env\\\\.test\\\\.local|env\\\\.prod\\\\.local|required|placeholder\" scripts/env/check-local-secret-files.sh",
        "rg -n \"check-local-secret-files\\\\.sh|prerequisite\" docs/ENVIRONMENT_SETUP.md"
      ]
    },
    "expected_output": [
      "Secret-file readiness gate exists and is documented."
    ],
    "stop_conditions": [
      "Stop and ask operator if required variable list is not yet finalized."
    ],
    "notes": []
  }
}
