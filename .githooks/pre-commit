#!/usr/bin/env bash
set -euo pipefail

REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

mapfile -t staged < <(git diff --cached --name-only --diff-filter=ACMRT -- 'apps/web/.local/directives/*' 'apps/web/.local/directives/**/*')

if [ "${#staged[@]}" -eq 0 ]; then
  exit 0
fi

args=()
for f in "${staged[@]}"; do
  args+=(--file "$f")
done

node .directive-cli/scripts/directives/validate_directives_frontmatter.mjs --strict "${args[@]}"
