{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "title": "remediation plan for edge data access and label styling",
    "status": "archived",
    "priority": "urgent",
    "owner": "operator",
    "assignee": null,
    "created": "2026-02-05T11:09:12.400Z",
    "updated": "2026-02-11T10:29:39.000Z",
    "summary": "Replace direct Supabase REST calls in UI pages with Edge Functions and remove global label styling.",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "medium",
    "tags": [
      "data-access",
      "edge-functions",
      "ui-style"
    ],
    "effort": "large",
    "session_priority": "ultra",
    "bucket": "archived",
    "depends_on": [],
    "blocked_by": [],
    "related": [],
    "auto_run": false,
    "result": "completed; executor logged lint and typecheck pass in 20260205T114755Z changelog entries.",
    "id": "57100fbd-3029-4ab6-be15-e313cfc281d3"
  },
  "task": {
    "objective": "Replace direct Supabase REST usage in `apps/web` with Edge Function calls and align label styling with the UI style contract.",
    "constraints": [
      "All UI reads and writes must go through Edge Functions.",
      "Do not call Supabase REST endpoints directly from UI code.",
      "SQL used by Edge Functions must be read only and compute results from existing tables.",
      "No em dash characters in generated writing.",
      "Follow `apps/web/README_COMPONENT_PARADIGM.md` and `docs/AGENT_RULES_WEB_UI.MD`."
    ],
    "allowed_files": [
      {
        "path": "Read: `apps/web/app/**/*`",
        "access": "edit"
      },
      {
        "path": "Read: `apps/web/components/ui/**/*`",
        "access": "edit"
      },
      {
        "path": "Read: `apps/web/lib/**/*`",
        "access": "edit"
      },
      {
        "path": "Read: `supabase/functions/**/*`",
        "access": "edit"
      },
      {
        "path": "Write: `apps/web/app/**/*`",
        "access": "edit"
      },
      {
        "path": "Write: `apps/web/components/ui/label.tsx`",
        "access": "edit"
      },
      {
        "path": "Write: `apps/web/app/globals.css`",
        "access": "edit"
      },
      {
        "path": "Write: `supabase/functions/**/*`",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Inventory UI files that call Supabase REST directly and capture the exact endpoints and payloads.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "For each required dataset, either locate an existing Edge Function or create a new one under `supabase/functions/` that returns the same data. Keep all SQL read only.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "Update the UI pages to call the Edge Functions instead of `rest/v1` endpoints and remove direct use of `NEXT_PUBLIC_SUPABASE_ANON_KEY` for REST access.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "Ensure Edge Function calls use existing patterns for auth headers and error handling seen in `apps/web/app/vendors/page.tsx` pack queue usage.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_5",
        "instruction": "Remove the global `label` selector in `apps/web/app/globals.css` and move its styling into `apps/web/components/ui/label.tsx` so all labels remain consistent via the component.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_6",
        "instruction": "Run lint and typecheck and resolve any issues that appear.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_7",
        "instruction": "Summarize the remediation results with the list of files touched and the Edge Functions created or reused.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "- `npm --prefix apps/web run lint`",
        "- `npm --prefix apps/web run typecheck`"
      ]
    },
    "expected_output": [
      "No UI code calls Supabase `rest/v1` endpoints directly.",
      "Label styling is controlled by `components/ui/label` and no global label selector remains.",
      "Lint and typecheck pass."
    ],
    "stop_conditions": [
      "Stop if a required data access path would need a non read only SQL change.",
      "Stop if the Edge Function requirements are unclear or require new backend capabilities."
    ],
    "notes": []
  }
}
