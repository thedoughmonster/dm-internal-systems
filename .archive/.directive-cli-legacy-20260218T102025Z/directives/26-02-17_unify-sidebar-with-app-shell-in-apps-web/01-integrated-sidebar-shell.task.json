{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "id": "9c2b65e6-192c-4737-bc3a-6f45d47264ee",
    "title": "Implement integrated sidebar rail and shared app shell",
    "status": "done",
    "priority": "high",
    "session_priority": "medium",
    "owner": "operator",
    "assignee": "executor",
    "bucket": "todo",
    "created": "2026-02-17T17:32:10Z",
    "updated": "2026-02-17T17:55:53Z",
    "tags": [],
    "effort": "medium",
    "depends_on": [],
    "blocked_by": [],
    "related": [],
    "summary": "Refactor apps/web layout so sidebar and content share a centered shell, with inset contained rail styling and responsive collapse behavior.",
    "execution_model": "gpt-5.3-codex",
    "thinking_level": "medium",
    "result": {
      "summary": "Implemented integrated inset sidebar shell styling, nav state improvements, semantic token definitions, and changelog with passing lint/typecheck.",
      "validation": {
        "status": "pass",
        "commands": [
          {
            "command": "npm --prefix apps/web run lint",
            "status": "pass",
            "exit_code": 0
          },
          {
            "command": "npm --prefix apps/web run typecheck",
            "status": "pass",
            "exit_code": 0
          },
          {
            "command": "rg -n -e \"--sidebar-background\" -e \"--sidebar-foreground\" -e \"--sidebar-accent\" -e \"--sidebar-border\" -e \"--sidebar-ring\" apps/web/app/styles/tokens-semantic.css",
            "status": "pass",
            "exit_code": 0
          }
        ],
        "changed_files": [
          ".codex/context/architect.startup.json",
          ".codex/context/executor.startup.json",
          ".directive-cli/scripts/directives/_directive_helpers.mjs",
          ".directive-cli/scripts/directives/_git_helpers.mjs",
          ".directive-cli/scripts/directives/scripts.test.mjs",
          "apps/web/app/composites/global-sidebar-shell.tsx",
          "apps/web/app/styles/tokens-semantic.css",
          "apps/web/components/ui/sidebar.tsx",
          "apps/web/tsconfig.json",
          "apps/web/changelog/20260217T174224Z_integrated_sidebar_shell.md"
        ],
        "branch": "feature/unify-sidebar-with-app-shell-in-apps-web",
        "commit": "67fd175"
      },
      "updated": "2026-02-17T17:55:53Z"
    }
  },
  "task": {
    "objective": "Unify sidebar and content into one cohesive application shell by introducing an inset, contained sidebar rail with aligned spacing, stronger navigation states, and responsive collapse behavior.",
    "constraints": [
      "Keep navigation routes and registry structure unchanged.",
      "Preserve GlobalSidebarSlot extensibility for page-level sidebar content overrides.",
      "Do not add new dependencies or change package manifests.",
      "Keep visual language consistent with existing apps/web semantic tokens and typography.",
      "Keep desktop behavior as persistent rail and mobile behavior as sheet/drawer."
    ],
    "allowed_files": [
      {
        "path": "`apps/web/app/composites/global-sidebar-shell.tsx` (edit)",
        "access": "edit"
      },
      {
        "path": "`apps/web/components/ui/sidebar.tsx` (edit)",
        "access": "edit"
      },
      {
        "path": "`apps/web/app/layout.tsx` (edit, only if shell alignment requires it)",
        "access": "edit"
      },
      {
        "path": "`apps/web/app/styles/tokens-semantic.css` (edit)",
        "access": "edit"
      },
      {
        "path": "`apps/web/changelog/*.md` (create)",
        "access": "create"
      },
      {
        "path": "`.directive-cli/scripts/directives/_directive_helpers.mjs` (allow pre-existing dirty context)",
        "access": "read"
      },
      {
        "path": "`.directive-cli/scripts/directives/_git_helpers.mjs` (allow pre-existing dirty context)",
        "access": "read"
      },
      {
        "path": "`.directive-cli/scripts/directives/scripts.test.mjs` (allow pre-existing dirty context)",
        "access": "read"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Refactor `apps/web/app/composites/global-sidebar-shell.tsx` so sidebar and main content render inside a shared centered shell with matching horizontal gutters and top alignment under the global header.",
        "files": [
          "apps/web/app/composites/global-sidebar-shell.tsx",
          "apps/web/app/layout.tsx"
        ],
        "artifact": "Desktop layout no longer appears edge-pinned; sidebar and content feel spatially connected."
      },
      {
        "id": "step_2",
        "instruction": "Adjust `apps/web/components/ui/sidebar.tsx` variant styling to produce a contained rail-card treatment on desktop (inset gutter, rounded surface, subtle border, soft elevation) while keeping current interaction semantics intact.",
        "files": [
          "apps/web/components/ui/sidebar.tsx"
        ],
        "artifact": "Sidebar reads as part of the app shell instead of an isolated viewport edge panel."
      },
      {
        "id": "step_3",
        "instruction": "Improve navigation legibility and state signaling in the sidebar menu (active, hover, focus-visible) so selection state is obvious without relying on text color alone.",
        "files": [
          "apps/web/app/composites/global-sidebar-shell.tsx",
          "apps/web/components/ui/sidebar.tsx"
        ],
        "artifact": "Active item has distinct visual treatment and keyboard focus remains clear."
      },
      {
        "id": "step_4",
        "instruction": "Ensure responsive behavior remains deterministic: persistent desktop rail, mobile sheet/drawer navigation, and smooth transitions aligned with existing motion token cadence.",
        "files": [
          "apps/web/components/ui/sidebar.tsx",
          "apps/web/app/composites/global-sidebar-shell.tsx"
        ],
        "artifact": "Mobile and desktop sidebar behaviors both work without layout jump regressions."
      },
      {
        "id": "step_5",
        "instruction": "Define missing sidebar semantic CSS variables in `apps/web/app/styles/tokens-semantic.css` to harmonize sidebar background, foreground, accent, border, and ring with current theme tokens.",
        "files": [
          "apps/web/app/styles/tokens-semantic.css"
        ],
        "artifact": "Sidebar colors derive from explicit semantic tokens and no longer depend on implicit/undefined variables."
      },
      {
        "id": "step_6",
        "instruction": "Add a concise changelog entry under `apps/web/changelog/` describing the sidebar integration update, scope, and validation evidence.",
        "files": [
          "apps/web/changelog/*.md"
        ],
        "artifact": "Changelog entry exists and documents impacted files and verification commands."
      }
    ],
    "validation": {
      "commands": [
        "npm --prefix apps/web run lint",
        "npm --prefix apps/web run typecheck",
        "rg -n -e \"--sidebar-background\" -e \"--sidebar-foreground\" -e \"--sidebar-accent\" -e \"--sidebar-border\" -e \"--sidebar-ring\" apps/web/app/styles/tokens-semantic.css"
      ]
    },
    "expected_output": [
      "Sidebar and content align inside one shared shell with consistent spacing and no left-edge detachment.",
      "Sidebar visual treatment is inset and contained, with clear active and focus states.",
      "Desktop and mobile sidebar behaviors remain stable and intentional.",
      "Lint and typecheck pass for apps/web."
    ],
    "stop_conditions": [
      "Stop and ask operator if integration requires changing route structure or navigation registry content.",
      "Stop and ask operator if meeting the visual goal requires edits outside allowed files.",
      "Stop and ask operator if unrelated pre-existing lint/typecheck failures block validation."
    ],
    "notes": [
      "Directive goals emphasize shell integration and responsive navigation consistency over route/content changes."
    ]
  }
}
