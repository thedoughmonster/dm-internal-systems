{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "id": "5e2f811a-bc4e-4f22-b13b-1447df5aa7bf",
    "title": "07-1-local-secret-source-files",
    "status": "todo",
    "priority": "medium",
    "session_priority": "medium",
    "summary": "",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "high"
  },
  "task": {
    "objective": "Introduce two canonical local secret source files so operators can manage secrets in one place per environment.",
    "constraints": [
      "Never commit secret values.",
      "Never print secret values in logs or docs.",
      "Keep local development defaulted to test values."
    ],
    "allowed_files": [
      {
        "path": "`.gitignore` (edit)",
        "access": "edit"
      },
      {
        "path": "`.env.test.example` (create)",
        "access": "edit"
      },
      {
        "path": "`.env.prod.example` (create)",
        "access": "edit"
      },
      {
        "path": "`docs/ENVIRONMENT_SETUP.md` (edit)",
        "access": "edit"
      },
      {
        "path": "`docs/DEPLOYMENT_INFRA_STATUS.md` (edit)",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Edit `.gitignore` and add entries for `.env.test.local` and `.env.prod.local`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "Create `.env.test.example` with all required key names and placeholder values only.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "Create `.env.prod.example` with the same key set as `.env.test.example` and placeholder values only.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "Edit `docs/ENVIRONMENT_SETUP.md` to define `.env.test.local` and `.env.prod.local` as canonical local secret source files.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_5",
        "instruction": "In `docs/ENVIRONMENT_SETUP.md`, add the local runtime instruction to copy `.env.test.local` to `.env.local` before local app runs.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_6",
        "instruction": "In `docs/ENVIRONMENT_SETUP.md`, add an explicit operator action note that actual `.env.test.local` and `.env.prod.local` values must be created locally before sync tasks run.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_7",
        "instruction": "In `docs/DEPLOYMENT_INFRA_STATUS.md`, mark `TASK_07.1` as completed and record UTC timestamp.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "rg -n \"\\\\.env\\\\.test\\\\.local|\\\\.env\\\\.prod\\\\.local\" .gitignore",
        "test -s .env.test.example",
        "test -s .env.prod.example",
        "rg -n \"env\\\\.test\\\\.local|env\\\\.prod\\\\.local|env\\\\.local\" docs/ENVIRONMENT_SETUP.md"
      ]
    },
    "expected_output": [
      "Local secret source strategy is documented and safe.",
      "Repo has templates but no secret values."
    ],
    "stop_conditions": [
      "Stop and ask operator if current repository policy requires a different env naming convention."
    ],
    "notes": []
  }
}
