{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "id": "52313e53-c906-459f-9b08-bd84991835fb",
    "title": "Enforce deterministic global and directives CSS contract guardrails",
    "status": "todo",
    "priority": "high",
    "session_priority": "high",
    "owner": "operator",
    "assignee": "executor",
    "bucket": "todo",
    "created": "2026-02-12T22:22:53.000Z",
    "updated": "2026-02-12T22:22:53.000Z",
    "tags": [
      "css",
      "directives",
      "lint",
      "enforcement",
      "tooling"
    ],
    "effort": "medium",
    "depends_on": [
      "4b318b2a-1121-48a6-8140-47080961986c"
    ],
    "blocked_by": [],
    "related": [],
    "summary": "Add deterministic guard scripts that enforce global CSS boundaries and directives token-only style contracts.",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "medium",
    "result": {
      "summary": "Added deterministic CSS guard validators under ops_tooling, wired package scripts, and remediated CSS/token violations so all guard checks pass.",
      "validation": "pass-with-warnings: npm --prefix apps/web run lint\npass: npm --prefix apps/web run typecheck\npass: npm --prefix apps/web run validate:global-css-boundary\npass: npm --prefix apps/web run validate:directives-css-contract\npass-with-warning: npm --prefix apps/web run build\nwarnings:\n- lint: apps/web/app/directives/composites/TagsInput.tsx:126 react-hooks/exhaustive-deps (2 warnings)\n- build: Next.js Turbopack warning for SUSE Mono fallback override values\nmanual visual checklist:\n- directives shell/session pages: not run (no browser-driven manual verification performed in this session)\n- snapshot evidence: not captured (no visual snapshot run in this session)\n",
      "updated": "20260212T232138Z"
    }
  },
  "task": {
    "objective": "Add deterministic guard scripts that enforce the locked global CSS boundary and directives CSS token contracts.",
    "constraints": [
      "Tooling must live under `ops_tooling/`.",
      "Guard checks must fail closed on violations.",
      "`:global(...)` in directives CSS Modules is allowed only with inline justification comments and minimal selector scope.",
      "Hardcoded literal values for color/spacing/radius/shadow in directives module CSS are disallowed."
    ],
    "allowed_files": [
      {
        "path": "`ops_tooling/scripts/css/validate_global_css_boundary.mjs` (create)",
        "access": "edit"
      },
      {
        "path": "`ops_tooling/scripts/css/validate_directives_css_contract.mjs` (create)",
        "access": "edit"
      },
      {
        "path": "`apps/web/package.json`",
        "access": "edit"
      },
      {
        "path": "`apps/web/app/globals.css`",
        "access": "edit"
      },
      {
        "path": "`apps/web/app/styles/**/*.css`",
        "access": "edit"
      },
      {
        "path": "`apps/web/app/directives/**/*.module.css`",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Create `validate_global_css_boundary.mjs` to enforce allowed global CSS scope and reject component-specific selector patterns in global layers.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "Create `validate_directives_css_contract.mjs` to enforce directives module CSS rules:",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "Add npm scripts in `apps/web/package.json` to execute both validators from `apps/web`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "Run validators and remediate any violations in allowed CSS files.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_5",
        "instruction": "Run lint and typecheck; record manual visual checklist evidence and snapshot evidence if elevated risk appears.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "npm --prefix apps/web run lint",
        "npm --prefix apps/web run typecheck",
        "npm --prefix apps/web run validate:global-css-boundary",
        "npm --prefix apps/web run validate:directives-css-contract"
      ]
    },
    "expected_output": [
      "Deterministic CSS contract validators exist and are executable from `apps/web` scripts.",
      "Global boundary and directives module contract checks pass.",
      "Locked CSS contract decisions are mechanically enforced."
    ],
    "stop_conditions": [
      "Stop and request direction if deterministic checks require third-party tooling adoption outside allowed files."
    ],
    "notes": []
  }
}
