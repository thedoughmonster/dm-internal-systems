{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "title": "lint and guardrails",
    "status": "archived",
    "priority": "high",
    "owner": "operator",
    "assignee": null,
    "created": "2026-02-04T16:01:05.000Z",
    "updated": "2026-02-11T10:29:39.000Z",
    "summary": "Add lint guardrails to enforce raw interactive and form element restrictions.",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "medium",
    "tags": [],
    "effort": "medium",
    "session_priority": "high",
    "bucket": "archived",
    "depends_on": [
      "TASK_rules-and-policy.md",
      "TASK_link-primitive.md"
    ],
    "blocked_by": [],
    "related": [],
    "id": "0038e1a4-425c-40df-976c-3157973dea26"
  },
  "task": {
    "objective": "Add lint guardrails that enforce the approved raw interactive and form element policy, including links.",
    "constraints": [
      "Do not over correct. Focus on interactive and form elements.",
      "Keep lint scope to apps/web.",
      "Do not introduce false positives for allowed patterns.",
      "No em dash characters in generated writing."
    ],
    "allowed_files": [
      {
        "path": "Read: `apps/web/eslint.config.mjs`",
        "access": "edit"
      },
      {
        "path": "Read: `apps/web/lib/eslint/*`",
        "access": "edit"
      },
      {
        "path": "Write: `apps/web/eslint.config.mjs`",
        "access": "edit"
      },
      {
        "path": "Write: `apps/web/lib/eslint/*`",
        "access": "edit"
      },
      {
        "path": "Write: `apps/web/AGENTS.md` only if it needs a pointer to the new lint rules.",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "Pause and confirm you are running `gpt-5.2-codex` (agentic) at high reasoning. If not, stop and ask the operator to switch models before writing lint rules.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "Inspect existing lint helper rules under `apps/web/lib/eslint` and the current config in `apps/web/eslint.config.mjs`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "Implement a JSX lint rule in a new helper module named `apps/web/lib/eslint/no-raw-form-elements.mjs`. Use a `JSXOpeningElement` visitor and a blocked tag list that includes `button`, `input`, `select`, `textarea`, `option`, and `a`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "In the rule, allow raw elements when the filename is under `apps/web/components/ui/` or `apps/web/components/ui/dm/`. Use `context.getFilename()` and normalize it so the check works for absolute paths.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_5",
        "instruction": "In the rule, allow raw `input` only when `type=\"hidden\"` and the element is outside `apps/web/components/ui/*`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_6",
        "instruction": "Keep the rule narrowly scoped to the blocked tag list only. Do not report other raw HTML elements.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_7",
        "instruction": "Register the rule in `apps/web/eslint.config.mjs` and set it to error with clear message text that mentions `apps/web/components/ui/*`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_8",
        "instruction": "Add a `no-restricted-imports` rule that bans importing `next/link` outside `apps/web/components/ui/dm/link.tsx`. The error message must direct engineers to use `DmLink` from `@/components/ui/dm/link`.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_9",
        "instruction": "Add an override so `apps/web/components/ui/dm/link.tsx` can import `next/link` without lint violations.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_10",
        "instruction": "Run lint once to confirm the rule is active. If it reports violations, record the file list and the count in the task result notes and continue to the remediation task.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_11",
        "instruction": "Document the lint behavior in `apps/web/AGENTS.md` only if the rule is non obvious or requires an exception list.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "- `npm --prefix apps/web run lint`",
        "- Note: lint may fail until `TASK_audit-and-remediation.md` is complete."
      ]
    },
    "expected_output": [
      "Lint rule added and wired into the apps/web lint config.",
      "Lint output clearly points to raw interactive or form element usage outside `apps/web/components/ui/*`.",
      "Rule file is named exactly `no-raw-form-elements.mjs`.",
      "Direct `next/link` imports are blocked outside `apps/web/components/ui/dm/link.tsx` with a clear error message."
    ],
    "stop_conditions": [
      "Stop if the rule produces false positives inside `apps/web/components/ui/*`.",
      "Stop if `input type=\\\"hidden\\\"` outside `apps/web/components/ui/*` is flagged."
    ],
    "notes": []
  }
}
