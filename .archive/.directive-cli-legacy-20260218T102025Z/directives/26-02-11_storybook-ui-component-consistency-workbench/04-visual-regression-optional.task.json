{
  "kind": "directive_task",
  "schema_version": "1.0",
  "meta": {
    "id": "1fe2bd05-cf23-4bc6-84b5-e05b8213ee99",
    "title": "Add optional visual regression path for storybook",
    "status": "archived",
    "priority": "medium",
    "session_priority": "high",
    "owner": "operator",
    "assignee": "executor",
    "bucket": "archived",
    "created": "2026-02-11T15:31:20.000Z",
    "updated": "2026-02-11T16:33:04.000Z",
    "tags": [
      "storybook",
      "visual-regression",
      "ci"
    ],
    "effort": "medium",
    "depends_on": [
      "59037f27-22e4-46c1-aef2-3e4e04a88f39",
      "1ed3e58b-2417-41a4-9b37-cefebd9fe9de",
      "fc7e7c3d-7f67-4f50-9510-134feb649248"
    ],
    "blocked_by": [],
    "related": [],
    "summary": "Provide an optional visual regression workflow path for Storybook to catch UI consistency drift in PRs.",
    "execution_model": "gpt-5.2-codex",
    "thinking_level": "high",
    "collection_id": "ui_component_workbench",
    "collection_title": "UI Component Workbench",
    "collection_order": 4,
    "collection_commit_label": "storybook-foundation",
    "collection_merge_ready": true,
    "result": "Executed successfully. Added `storybook:build:ci` script and adjusted lint script to ignore generated `storybook-static` output, added optional secret-gated `visual-regression` job (Chromatic) to `.github/workflows/ci-baseline.yml` with explicit skip behavior when token is missing, and documented enablement requirements plus fallback behavior in `storybook-setup.md`. Validation commands passed: `npm --prefix apps/web run lint`, `npm --prefix apps/web run typecheck`, and `rg -n \"storybook|visual|chromatic|secret\" .github/workflows/ci-baseline.yml apps/web/docs/guides/storybook-setup.md`. Lint reports two pre-existing warnings in `app/directives/composites/TagsInput.tsx` with zero errors."
  },
  "task": {
    "objective": "Add an optional CI path for visual regression checks using Storybook.",
    "constraints": [
      "Keep this task non-blocking if required external token/secrets are unavailable.",
      "Do not break existing CI workflows.",
      "Document exactly what is required to enable the workflow."
    ],
    "allowed_files": [
      {
        "path": "`apps/web/package.json` (edit)",
        "access": "edit"
      },
      {
        "path": "`.github/workflows/ci-baseline.yml` (edit)",
        "access": "edit"
      },
      {
        "path": "`apps/web/docs/guides/storybook-setup.md` (edit)",
        "access": "edit"
      }
    ],
    "steps": [
      {
        "id": "step_1",
        "instruction": "In `apps/web/package.json`, add any scripts required for visual regression execution against Storybook build output.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_2",
        "instruction": "In `.github/workflows/ci-baseline.yml`, add an optional visual regression step that is gated on required secret availability.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_3",
        "instruction": "In `apps/web/docs/guides/storybook-setup.md`, document enablement prerequisites and fallback behavior when secret is missing.",
        "files": [],
        "artifact": ""
      },
      {
        "id": "step_4",
        "instruction": "Ensure the workflow remains green when visual regression is skipped due to missing secret.",
        "files": [],
        "artifact": ""
      }
    ],
    "validation": {
      "commands": [
        "npm --prefix apps/web run lint",
        "npm --prefix apps/web run typecheck",
        "rg -n \"storybook|visual|chromatic|secret\" .github/workflows/ci-baseline.yml apps/web/docs/guides/storybook-setup.md"
      ]
    },
    "expected_output": [
      "Visual regression path exists and is explicitly documented as optional when external prerequisites are not present."
    ],
    "stop_conditions": [
      "Stop and ask operator if introducing external visual regression service is not acceptable for this repository."
    ],
    "notes": []
  }
}
